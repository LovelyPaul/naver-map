# 유저플로우 문서

## 1. 메인 지도 화면 진입

### 입력
- 사용자가 애플리케이션 URL에 접속
- 브라우저 위치 권한 요청 팝업에 대한 사용자 응답 (허용/거부)

### 처리
1. 애플리케이션 초기화 및 메인 페이지 렌더링
2. 네이버 지도 SDK 초기화 및 로드
3. 위치 권한 확인
   - 허용된 경우: 현재 GPS 좌표 획득
   - 거부된 경우: 기본 중심 좌표 (서울 중심부 등) 사용
4. 지도 인스턴스 생성 및 중심점 설정
5. 검색 UI 컴포넌트 렌더링 (지도 위 오버레이)
6. 서비스 로고/타이틀 표시

### 출력
- 네이버 지도가 표시된 메인 화면
- 지도 상단에 고정된 검색창
- 화면 상단에 서비스 로고/제목
- 지도 중심점이 사용자 현재 위치 또는 기본 위치로 설정됨

### 엣지케이스
- **네이버 지도 SDK 로드 실패**: 에러 메시지 표시 및 재시도 옵션 제공
- **위치 권한 미결정 상태**: 기본 위치로 표시하고 권한 재요청 안내
- **GPS 정보 획득 시간 초과**: 타임아웃 후 기본 위치로 폴백
- **네트워크 연결 없음**: 오프라인 상태 안내 메시지

---

## 2. 장소/맛집 검색

### 입력
- 사용자가 검색창에 장소명 또는 맛집명 입력
- 검색 버튼 클릭 또는 엔터 키 입력

### 처리
1. 입력값 유효성 검증 (빈 문자열, 특수문자 등)
2. 네이버 지도 Places API 또는 검색 API 호출
3. 검색 결과 데이터 파싱 및 정규화
   - 장소명, 주소, 좌표, 카테고리 정보 추출
4. 자체 데이터베이스에서 해당 장소의 리뷰 존재 여부 조회
5. 지도에 검색 결과 마커 표시
   - 리뷰 있는 장소: 특수 마커 (예: 빨간색 마커)
   - 리뷰 없는 장소: 기본 마커 (예: 회색 마커)
6. 검색 결과 리스트 UI 생성 및 렌더링

### 출력
- 지도 화면에 검색 결과 위치마다 마커 표시
- 지도 하단 또는 사이드에 검색 결과 리스트 표시
  - 각 항목: 장소명, 주소, 카테고리(대분류 > 소분류), 대표 이미지, 리뷰 작성 버튼
- 지도 뷰포트가 검색 결과를 모두 포함하도록 자동 조정
- 리스트 항목 개수 표시

### 엣지케이스
- **검색 결과 없음**: 결과 없음 안내 메시지 표시
- **검색어가 너무 짧음 (1-2자)**: 최소 글자 수 안내 또는 자동완성 제안
- **API 요청 실패**: 에러 메시지 표시 및 재시도 옵션
- **검색 결과 과다 (100개 이상)**: 페이지네이션 또는 상위 N개만 표시
- **카테고리 정보 누락**: 기본 카테고리 표시 또는 미분류 표시
- **대표 이미지 없음**: 기본 플레이스홀더 이미지 사용

---

## 3. 검색 결과에서 장소 선택

### 입력
- 사용자가 검색 결과 리스트의 특정 항목 클릭
- 또는 지도의 특정 마커 클릭

### 처리
1. 선택된 장소의 고유 식별자 확인
2. 리스트와 지도의 해당 항목 하이라이트 처리
   - 리스트: 배경색 변경 또는 테두리 강조
   - 지도: 마커 색상/크기 변경 또는 애니메이션 효과
3. 지도 중심을 선택된 장소로 이동
4. 선택된 장소의 상세 정보 패널 표시 준비

### 출력
- 선택된 장소가 시각적으로 강조됨
- 지도 화면 중심이 선택된 장소로 이동
- 다른 마커들은 비활성화 스타일 적용

### 엣지케이스
- **동시에 여러 장소 선택 시도**: 가장 최근 선택만 유효
- **이미 선택된 장소 재선택**: 선택 해제 또는 상세 정보 토글

---

## 4. 장소 상세 정보 및 리뷰 조회

### 입력
- 장소 선택 후 자동 트리거 또는 상세보기 버튼 클릭

### 처리
1. 선택된 장소의 ID로 자체 DB에서 리뷰 목록 조회
2. 리뷰 데이터 정렬 (최신순, 평점순 등)
3. 평균 평점 계산 (총 별점 합계 / 리뷰 개수)
4. 상세 정보 패널 UI 구성
   - 장소 기본 정보 (식당명, 주소, 카테고리)
   - 평균 평점 및 리뷰 개수
   - 리뷰 목록 (작성자, 별점, 내용, 작성일)
5. 패널을 모달 또는 슬라이드 형태로 표시

### 출력
- 장소 상세 정보 패널/모달 표시
- 장소 기본 정보 섹션
- 평균 평점 및 총 리뷰 수
- 리뷰 목록 (초기 3-5개 표시)
- "전체 리뷰 보기" 또는 "더보기" 버튼
- "리뷰 작성" 버튼

### 엣지케이스
- **리뷰가 없는 장소**: 리뷰 없음 안내 및 첫 리뷰 작성 유도 메시지
- **리뷰 로딩 실패**: 에러 메시지 및 재시도 버튼
- **리뷰 개수 과다**: 초기 일부만 로드 후 스크롤 시 추가 로드 (무한 스크롤 또는 페이지네이션)
- **장소 정보 누락**: 사용할 수 있는 정보만 표시

---

## 5. 전체 리뷰 펼치기

### 입력
- 사용자가 "전체 리뷰 보기" 또는 "더보기" 버튼 클릭
- 또는 리뷰 목록 하단까지 스크롤

### 처리
1. 다음 페이지 리뷰 데이터 요청 (오프셋 기반 또는 커서 기반 페이지네이션)
2. 기존 리뷰 목록에 새 데이터 추가
3. UI 리렌더링

### 출력
- 추가 리뷰 항목들이 리스트에 표시됨
- 더 불러올 리뷰가 있으면 버튼 유지, 없으면 버튼 숨김 또는 "마지막 리뷰입니다" 메시지

### 엣지케이스
- **더 이상 리뷰 없음**: 안내 메시지 표시
- **페이지네이션 요청 실패**: 에러 메시지 및 재시도
- **중복 데이터 로드**: 클라이언트 측 중복 제거

---

## 6. 리뷰 작성 페이지 진입

### 입력
- 사용자가 검색 결과 리스트의 "리뷰 작성" 버튼 클릭
- 또는 장소 상세 정보 패널의 "리뷰 작성" 버튼 클릭

### 처리
1. 선택된 장소 정보 확인 및 전달
2. 리뷰 작성 페이지로 라우팅 또는 모달 표시
3. 장소 기본 정보 (식당명, 주소, 카테고리) 자동 채움
4. 리뷰 작성 폼 초기화
   - 작성자 입력 필드: 빈 값
   - 평점: 미선택 (별 0개)
   - 리뷰 내용: 빈 값
   - 비밀번호: 빈 값

### 출력
- 리뷰 작성 페이지 또는 모달 표시
- 상단에 뒤로가기 버튼
- 장소 기본 정보 섹션 (읽기 전용)
- 리뷰 작성 폼
  - 작성자 입력 필드
  - 별점 선택 UI (별 5개)
  - 리뷰 내용 입력 필드 (최대 500자)
  - 비밀번호 입력 필드
- 하단에 "리뷰 작성하기" 제출 버튼

### 엣지케이스
- **장소 정보 누락**: 에러 메시지 표시 및 이전 화면으로 복귀
- **모달이 아닌 페이지 이동 시**: 브라우저 뒤로가기 지원

---

## 7. 리뷰 작성 및 제출

### 입력
- 사용자가 작성자명 입력 (닉네임 또는 이메일)
- 별점 선택 (1-5개 별 클릭)
- 리뷰 내용 입력 (최대 500자)
- 비밀번호 입력
- "리뷰 작성하기" 버튼 클릭

### 처리
1. 클라이언트 측 유효성 검증
   - 작성자명: 필수, 2-50자
   - 별점: 필수, 1-5 범위
   - 리뷰 내용: 필수, 1-500자
   - 비밀번호: 필수, 4자 이상
2. 검증 실패 시 에러 메시지 표시 및 제출 중단
3. 검증 통과 시 서버로 POST 요청
   - 장소 ID, 작성자, 평점, 리뷰 내용, 비밀번호(해시 처리)
4. 서버 측 재검증 및 DB 저장
5. 응답 수신 및 처리

### 출력
- 제출 중 로딩 인디케이터 표시
- 성공 시:
  - 성공 메시지 표시 (토스트 또는 알림)
  - 장소 상세 정보 화면으로 자동 이동
  - 작성한 리뷰가 리뷰 목록 최상단에 표시됨
  - 지도 마커가 리뷰 존재 마커로 변경됨
- 실패 시:
  - 에러 메시지 표시
  - 작성 중인 내용 유지

### 엣지케이스
- **필수 필드 누락**: 해당 필드에 에러 메시지 표시
- **글자 수 초과**: 입력 제한 또는 경고 메시지
- **네트워크 에러**: 에러 메시지 및 재시도 옵션, 로컬 스토리지에 임시 저장
- **중복 제출 방지**: 제출 버튼 비활성화 (제출 중)
- **서버 측 검증 실패**: 서버 에러 메시지 표시
- **비밀번호 형식 불일치**: 비밀번호 규칙 안내 (최소 길이 등)
- **작성자명이 이메일 형식인 경우**: 이메일 형식 검증 추가

---

## 8. 리뷰 작성 후 지도 마커 업데이트

### 입력
- 리뷰 작성 완료 이벤트

### 처리
1. 서버로부터 리뷰 생성 성공 응답 수신
2. 클라이언트 측 장소 상태 업데이트 (리뷰 존재 플래그)
3. 지도에서 해당 장소 마커 탐색
4. 마커 스타일 변경
   - 기본 마커 → 리뷰 존재 마커 (색상, 아이콘 변경)
5. 마커 클릭 이벤트에 툴팁 정보 추가
   - 리뷰 요약 (평균 평점, 리뷰 개수)

### 출력
- 지도에서 해당 장소 마커가 즉시 리뷰 존재 마커로 변경됨
- 마커에 마우스 오버 또는 클릭 시 미리보기 툴팁 표시
  - 평균 평점 (별 모양)
  - 총 리뷰 개수
  - 최근 리뷰 미리보기 (옵션)

### 엣지케이스
- **마커 업데이트 실패**: 페이지 새로고침 시 정상 반영됨
- **다른 사용자가 동시에 리뷰 작성**: 실시간 업데이트 없이 다음 조회 시 반영

---

## 9. 리뷰 존재 장소 마커 클릭 (툴팁 표시)

### 입력
- 사용자가 리뷰 존재 마커를 클릭 또는 마우스 오버

### 처리
1. 마커 클릭 이벤트 감지
2. 해당 장소 ID로 리뷰 요약 정보 조회
   - 평균 평점, 총 리뷰 개수, 최근 리뷰 1-2개
3. 툴팁 UI 생성 및 위치 계산 (마커 위 또는 옆)
4. 툴팁 표시

### 출력
- 마커 근처에 작은 툴팁/팝업 표시
  - 장소명
  - 평균 평점 (별 그래픽)
  - 총 리뷰 개수
  - 최근 리뷰 미리보기 (작성자, 평점, 내용 일부)
- 툴팁에 "자세히 보기" 버튼 (클릭 시 장소 상세 정보로 이동)

### 엣지케이스
- **리뷰 요약 로딩 지연**: 로딩 인디케이터 표시
- **툴팁이 화면 밖으로 나감**: 위치 자동 조정
- **마우스 아웃 시**: 툴팁 자동 숨김 또는 닫기 버튼 제공

---

## 10. 뒤로가기 (리뷰 작성 페이지에서)

### 입력
- 사용자가 리뷰 작성 페이지 상단의 뒤로가기 버튼 클릭
- 또는 브라우저 뒤로가기 버튼 클릭

### 처리
1. 작성 중인 데이터 존재 여부 확인
2. 데이터가 있으면 확인 다이얼로그 표시
   - "작성 중인 내용이 있습니다. 나가시겠습니까?"
3. 사용자 선택에 따라 처리
   - 확인: 이전 화면으로 이동 (작성 내용 폐기)
   - 취소: 작성 페이지 유지

### 출력
- 작성 내용이 없거나 사용자가 확인한 경우: 검색 결과 또는 장소 상세 정보 화면으로 복귀
- 작성 내용이 있고 사용자가 취소한 경우: 작성 페이지 유지

### 엣지케이스
- **작성 내용 없음**: 확인 다이얼로그 없이 즉시 이동
- **모달 형태인 경우**: 모달 닫기
- **페이지 형태인 경우**: 라우터 히스토리 백

---

## 11. 리뷰 수정/삭제 (향후 기능)

### 입력
- 사용자가 자신이 작성한 리뷰의 수정/삭제 버튼 클릭
- 비밀번호 입력

### 처리
1. 비밀번호 검증 모달 표시
2. 입력된 비밀번호와 저장된 해시 비교
3. 검증 성공 시:
   - 수정: 리뷰 작성 폼에 기존 데이터 채움
   - 삭제: 삭제 확인 다이얼로그 표시 후 DB에서 삭제
4. 검증 실패 시: 에러 메시지 표시

### 출력
- 수정 성공: 업데이트된 리뷰 표시
- 삭제 성공: 리뷰 목록에서 제거, 리뷰 개수 업데이트, 마커 상태 업데이트 (리뷰 0개 시 기본 마커로 변경)
- 검증 실패: 비밀번호 오류 메시지

### 엣지케이스
- **비밀번호 불일치**: 재시도 기회 제공 (3회 제한 등)
- **마지막 리뷰 삭제**: 마커를 기본 마커로 변경
- **수정 중 네트워크 에러**: 에러 메시지 및 재시도

---

## 12. 검색어 초기화 및 지도 재탐색

### 입력
- 사용자가 검색창의 X 버튼 클릭 또는 검색어 전체 삭제
- 또는 지도를 드래그/줌하여 새로운 영역 탐색

### 처리
1. 검색어 초기화 시:
   - 검색 결과 마커 모두 제거
   - 검색 결과 리스트 숨김 또는 제거
   - 지도를 초기 중심점으로 복귀 (옵션)
2. 지도 이동 시:
   - 새로운 뷰포트 내 리뷰 존재 장소 마커만 표시 (옵션)
   - 또는 모든 리뷰 존재 장소 마커 지속 표시

### 출력
- 검색 결과 마커 제거 및 빈 지도 화면
- 또는 리뷰 존재 장소 마커만 남음
- 검색 결과 리스트 숨김

### 엣지케이스
- **지도 이동 중 검색**: 이전 검색 결과 유지 또는 초기화 (정책에 따라)
- **검색 결과와 리뷰 마커 혼재**: 시각적 구분 (색상, 아이콘)

---

## 13. 별점 선택 인터랙션

### 입력
- 사용자가 리뷰 작성 폼에서 별 아이콘 클릭

### 처리
1. 클릭된 별의 인덱스 확인 (1-5)
2. 해당 인덱스까지의 별 모두 선택 상태로 변경
3. 선택되지 않은 별은 비선택 상태로 유지
4. 선택된 별 개수를 평점 값으로 저장

### 출력
- 선택된 별들이 노란색 또는 채워진 아이콘으로 변경
- 선택되지 않은 별들은 회색 또는 빈 아이콘으로 표시
- 평점 값이 폼 상태에 반영됨

### 엣지케이스
- **동일한 별 재클릭**: 해당 평점 유지 또는 평점 초기화 (정책에 따라)
- **모바일 터치**: 터치 이벤트 처리
- **반 별 선택 (3.5점 등)**: 현재는 정수만 지원, 향후 확장 가능

---

## 14. 리뷰 내용 글자 수 제한

### 입력
- 사용자가 리뷰 내용 입력 필드에 텍스트 입력

### 처리
1. 입력 이벤트마다 현재 글자 수 계산
2. 글자 수가 500자를 초과하는지 확인
3. 초과 시 입력 제한 또는 경고 표시

### 출력
- 입력 필드 하단에 현재 글자 수 / 최대 글자 수 표시 (예: 123 / 500)
- 500자 초과 시:
  - 추가 입력 차단 (maxLength 속성)
  - 또는 경고 메시지 표시 및 제출 버튼 비활성화

### 엣지케이스
- **복사-붙여넣기로 500자 초과 입력**: 자동으로 500자까지만 잘라내기
- **이모지 또는 특수문자**: 문자 길이 정확히 계산 (유니코드 고려)
- **줄바꿈 문자**: 글자 수에 포함 여부 명확히 정의

---

## 15. 카테고리 2-depth 표시

### 입력
- 검색 결과 또는 장소 정보에서 카테고리 데이터 수신

### 처리
1. 카테고리 데이터 파싱 (대분류, 소분류)
2. 2-depth 형식으로 문자열 구성 (예: "한식 > 소고기 구이")
3. UI에 렌더링

### 출력
- 검색 결과 리스트 항목 및 장소 상세 정보에 "대분류 > 소분류" 형식 표시

### 엣지케이스
- **소분류 없음**: 대분류만 표시
- **카테고리 정보 전체 누락**: "미분류" 또는 빈 값 표시
- **카테고리 depth가 3 이상**: 상위 2개만 표시 또는 전체 표시 (정책 결정 필요)
