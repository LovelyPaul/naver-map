# Usecase: 장소/맛집 검색

## 1. Usecase 개요

### 1.1 Usecase ID
`UC-002`

### 1.2 Usecase 이름
장소/맛집 검색

### 1.3 목적
사용자가 지도상에서 원하는 장소나 맛집을 검색하여 해당 위치를 지도와 리스트로 확인할 수 있도록 한다.

### 1.4 범위
- 검색어 입력 및 유효성 검증
- 네이버 지도 Places API 연동
- 검색 결과 지도 마커 표시
- 검색 결과 리스트 UI 표시
- 리뷰 존재 여부에 따른 마커 구분

### 1.5 우선순위
P0 (필수)

---

## 2. Actors (행위자)

### 2.1 Primary Actor
- **사용자**: 맛집 정보를 찾고자 하는 일반 사용자

### 2.2 Secondary Actor
- **네이버 지도 Places API**: 장소 검색 결과를 제공하는 외부 시스템
- **Supabase DB**: 리뷰 존재 여부 조회를 위한 데이터베이스

---

## 3. Preconditions (선행 조건)

### 3.1 필수 선행 조건
- 사용자가 메인 지도 페이지에 접속되어 있어야 함
- 네이버 지도 SDK가 정상적으로 로드되어 있어야 함
- 검색 UI 컴포넌트가 화면에 표시되어 있어야 함

### 3.2 선택 선행 조건
- 네트워크 연결이 안정적이어야 함
- 네이버 Maps API 키가 유효해야 함

---

## 4. Postconditions (후행 조건)

### 4.1 성공 시나리오 후행 조건
- 검색 결과가 지도 마커로 표시됨
- 검색 결과 리스트가 화면에 표시됨
- 지도 뷰포트가 검색 결과를 포함하도록 자동 조정됨
- 리뷰가 있는 장소와 없는 장소가 시각적으로 구분됨

### 4.2 실패 시나리오 후행 조건
- 에러 메시지가 사용자에게 표시됨
- 기존 검색 결과는 유지되거나 초기화됨
- 사용자가 재시도할 수 있는 옵션이 제공됨

---

## 5. Main Success Scenario (주요 성공 시나리오)

### 5.1 Basic Flow

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 1 | 사용자 | 메인 페이지 상단의 검색창을 클릭한다 |
| 2 | 시스템 | 검색창에 포커스를 준다 |
| 3 | 사용자 | 검색어를 입력한다 (예: "강남역 한식") |
| 4 | 시스템 | 입력값을 실시간으로 검증한다 (최소 2자 이상) |
| 5 | 사용자 | 검색 버튼을 클릭하거나 Enter 키를 누른다 |
| 6 | 시스템 | 검색 버튼을 비활성화하고 로딩 인디케이터를 표시한다 |
| 7 | 시스템 | 입력값에 대한 최종 유효성 검증을 수행한다 |
| 8 | 시스템 | 네이버 지도 Places API에 검색 요청을 전송한다 |
| 9 | 시스템 | API로부터 검색 결과를 수신하고 데이터를 정규화한다 |
| 10 | 시스템 | 각 검색 결과 장소의 리뷰 존재 여부를 Supabase DB에서 조회한다 |
| 11 | 시스템 | 검색 결과를 지도에 마커로 표시한다 (리뷰 유무에 따라 다른 스타일 적용) |
| 12 | 시스템 | 지도 뷰포트를 검색 결과를 모두 포함하도록 자동 조정한다 |
| 13 | 시스템 | 검색 결과 리스트를 화면 하단 또는 사이드에 표시한다 |
| 14 | 시스템 | 각 결과 카드에 장소명, 주소, 카테고리, 대표 이미지, 리뷰 작성 버튼을 표시한다 |
| 15 | 시스템 | 로딩 인디케이터를 숨기고 검색 버튼을 활성화한다 |
| 16 | 사용자 | 검색 결과를 확인한다 |

### 5.2 데이터 흐름

```
[사용자 입력] → [클라이언트 검증] → [API 요청]
    ↓
[네이버 Places API]
    ↓
[검색 결과 수신] → [데이터 정규화]
    ↓
[Supabase DB 조회] (리뷰 존재 여부)
    ↓
[결과 병합] → [지도 마커 렌더링] + [리스트 UI 렌더링]
```

---

## 6. Alternative Flows (대안 흐름)

### 6.1 Alternative Flow A: 검색어가 너무 짧은 경우

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 4a | 시스템 | 검색어가 2자 미만임을 감지한다 |
| 4b | 시스템 | 검색 버튼을 비활성화한다 |
| 4c | 시스템 | 검색창 하단에 "최소 2자 이상 입력해주세요" 메시지를 표시한다 |
| 4d | 사용자 | 추가 문자를 입력한다 |
| 4e | 시스템 | 2자 이상이 되면 검색 버튼을 활성화하고 메시지를 제거한다 |
| - | - | Main Flow 5단계로 복귀 |

### 6.2 Alternative Flow B: 검색 결과가 없는 경우

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 9a | 시스템 | API로부터 빈 결과 배열을 수신한다 |
| 9b | 시스템 | 지도 마커를 표시하지 않는다 |
| 9c | 시스템 | 결과 리스트 영역에 "검색 결과가 없습니다" 메시지를 표시한다 |
| 9d | 시스템 | 다른 검색어로 재시도하도록 안내 메시지를 표시한다 |
| 9e | 사용자 | 검색어를 수정하거나 새로운 검색을 시도한다 |
| - | - | Main Flow 3단계로 복귀 |

### 6.3 Alternative Flow C: 검색 결과가 100개 이상인 경우

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 9a | 시스템 | API로부터 100개 이상의 결과를 수신한다 |
| 9b | 시스템 | 상위 50개만 표시하도록 결과를 제한한다 |
| 9c | 시스템 | 결과 리스트 상단에 "50개 결과만 표시됩니다. 더 구체적인 검색어를 입력해주세요" 안내 메시지를 표시한다 |
| 9d | 시스템 | 제한된 결과로 지도 마커 및 리스트를 렌더링한다 |
| - | - | Main Flow 11단계로 복귀 |

### 6.4 Alternative Flow D: 카테고리 정보가 누락된 경우

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 14a | 시스템 | 특정 결과의 카테고리 정보가 없음을 감지한다 |
| 14b | 시스템 | 카테고리 필드에 "카테고리 미분류" 텍스트를 표시한다 |
| 14c | 시스템 | 다른 정보는 정상적으로 표시한다 |
| - | - | Main Flow 15단계로 복귀 |

### 6.5 Alternative Flow E: 대표 이미지가 없는 경우

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 14a | 시스템 | 특정 결과의 이미지 URL이 없거나 유효하지 않음을 감지한다 |
| 14b | 시스템 | picsum.photos를 활용한 플레이스홀더 이미지를 표시한다 |
| 14c | 시스템 | 다른 정보는 정상적으로 표시한다 |
| - | - | Main Flow 15단계로 복귀 |

---

## 7. Exception Flows (예외 흐름)

### 7.1 Exception Flow A: 네이버 API 요청 실패

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 8a | 시스템 | API 요청이 실패하거나 타임아웃이 발생한다 |
| 8b | 시스템 | 에러를 로깅한다 |
| 8c | 시스템 | 로딩 인디케이터를 숨긴다 |
| 8d | 시스템 | 사용자에게 "검색 중 오류가 발생했습니다. 다시 시도해주세요" 토스트 메시지를 표시한다 |
| 8e | 시스템 | 검색 버튼을 활성화한다 |
| 8f | 사용자 | 재시도 버튼을 클릭하거나 검색을 다시 시도한다 |
| - | - | Main Flow 5단계로 복귀 |

### 7.2 Exception Flow B: Supabase DB 조회 실패

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 10a | 시스템 | DB 조회 중 오류가 발생한다 |
| 10b | 시스템 | 에러를 로깅한다 |
| 10c | 시스템 | 모든 장소를 "리뷰 없음"으로 간주하여 기본 마커로 표시한다 |
| 10d | 시스템 | 백그라운드에서 재시도를 수행한다 (옵션) |
| - | - | Main Flow 11단계로 복귀 |

### 7.3 Exception Flow C: 네트워크 연결 끊김

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 8a | 시스템 | 네트워크 연결이 없음을 감지한다 |
| 8b | 시스템 | 로딩 인디케이터를 숨긴다 |
| 8c | 시스템 | "인터넷 연결을 확인해주세요" 메시지를 표시한다 |
| 8d | 시스템 | 네트워크 상태를 모니터링한다 |
| 8e | 시스템 | 연결이 복구되면 자동으로 재시도 옵션을 제공한다 |
| - | - | Usecase 종료 |

### 7.4 Exception Flow D: 지도 SDK 오류

| 단계 | 행위자 | 시스템 동작 |
|------|--------|-------------|
| 11a | 시스템 | 지도 마커 렌더링 중 오류가 발생한다 |
| 11b | 시스템 | 에러를 로깅한다 |
| 11c | 시스템 | 리스트 UI는 정상적으로 표시한다 |
| 11d | 시스템 | "지도 표시 중 오류가 발생했습니다" 메시지를 표시한다 |
| 11e | 시스템 | 페이지 새로고침 옵션을 제공한다 |
| - | - | Usecase 종료 |

---

## 8. Business Rules (비즈니스 규칙)

### 8.1 검색어 규칙
- **BR-001**: 검색어는 최소 2자 이상이어야 한다
- **BR-002**: 검색어는 최대 100자로 제한한다
- **BR-003**: 특수문자만으로 구성된 검색어는 허용하지 않는다
- **BR-004**: 검색어 앞뒤 공백은 자동으로 제거한다

### 8.2 검색 결과 규칙
- **BR-005**: 최대 50개의 검색 결과만 표시한다
- **BR-006**: 검색 결과는 네이버 API의 정렬 순서를 따른다 (관련도순)
- **BR-007**: 동일한 장소가 중복으로 표시되지 않도록 한다

### 8.3 마커 표시 규칙
- **BR-008**: 리뷰가 있는 장소는 빨간색 마커로 표시한다
- **BR-009**: 리뷰가 없는 장소는 회색 마커로 표시한다
- **BR-010**: 마커는 클릭 가능한 상태여야 한다
- **BR-011**: 지도 뷰포트는 모든 마커를 포함하도록 자동 조정된다

### 8.4 리스트 표시 규칙
- **BR-012**: 카테고리는 "대분류 > 소분류" 형식으로 표시한다
- **BR-013**: 카테고리 정보가 없으면 "카테고리 미분류"로 표시한다
- **BR-014**: 이미지가 없으면 플레이스홀더 이미지를 표시한다
- **BR-015**: 각 결과 카드는 클릭 가능해야 한다

### 8.5 성능 규칙
- **BR-016**: 검색 결과는 2초 이내에 표시되어야 한다
- **BR-017**: 검색어 입력 시 디바운싱(300ms)을 적용한다
- **BR-018**: 연속된 동일 검색은 캐싱된 결과를 사용한다

---

## 9. Special Requirements (특수 요구사항)

### 9.1 성능 요구사항
- **SR-001**: API 응답 시간은 평균 1.5초 이내
- **SR-002**: 마커 렌더링 시간은 500ms 이내
- **SR-003**: 리스트 렌더링 시간은 300ms 이내

### 9.2 보안 요구사항
- **SR-004**: 검색어는 XSS 방지를 위해 sanitize 처리
- **SR-005**: API 키는 환경 변수로 관리
- **SR-006**: Rate limiting 적용 (사용자당 1분에 최대 20회 검색)

### 9.3 접근성 요구사항
- **SR-007**: 검색창은 키보드로 접근 가능해야 함
- **SR-008**: 검색 버튼은 Enter 키로 실행 가능해야 함
- **SR-009**: 스크린 리더는 검색 결과 개수를 읽을 수 있어야 함
- **SR-010**: 포커스 인디케이터가 명확해야 함

### 9.4 사용성 요구사항
- **SR-011**: 로딩 상태가 시각적으로 명확해야 함
- **SR-012**: 에러 메시지는 구체적이고 실행 가능한 안내를 포함해야 함
- **SR-013**: 검색 결과가 0개일 때 대안을 제시해야 함

### 9.5 호환성 요구사항
- **SR-014**: Chrome, Safari, Firefox, Edge 최신 2개 버전 지원
- **SR-015**: 모바일 브라우저 지원 (iOS Safari, Android Chrome)
- **SR-016**: 화면 크기 375px 이상에서 정상 동작

---

## 10. Frequency of Use (사용 빈도)
- **예상 빈도**: 사용자당 세션당 평균 3-5회
- **피크 시간**: 점심시간 (11:30-13:00), 저녁시간 (18:00-20:00)

---

## 11. User Interface Requirements (UI 요구사항)

### 11.1 검색창 UI
- 위치: 지도 상단 중앙 고정 (overlay)
- 너비: 최대 600px, 모바일에서는 화면 너비의 90%
- 높이: 48px
- 구성 요소:
  - 검색 아이콘 (좌측)
  - 입력 필드 (중앙)
  - 지우기 버튼 (우측, 입력값이 있을 때만 표시)
  - 검색 버튼 (우측)

### 11.2 검색 결과 리스트 UI
- 위치: 모바일은 하단 슬라이드업 패널, 데스크톱은 좌측 사이드바
- 높이: 모바일은 화면의 50%, 데스크톱은 전체 높이
- 각 결과 카드:
  - 대표 이미지 (좌측, 80x80px)
  - 장소명 (우측 상단, 16px Bold)
  - 주소 (우측 중단, 14px Regular, 회색)
  - 카테고리 (우측 중단, 12px Regular, 회색)
  - 리뷰 작성 버튼 (우측 하단, Primary 색상)

### 11.3 마커 UI
- 리뷰 있음: 빨간색 핀 마커, 아이콘 크기 32x40px
- 리뷰 없음: 회색 핀 마커, 아이콘 크기 28x36px
- 호버 시: 약간 확대 애니메이션 (scale 1.1)
- 선택 시: 바운스 애니메이션

---

## 12. Data Requirements (데이터 요구사항)

### 12.1 입력 데이터

#### Search Request DTO
```typescript
interface SearchRequest {
  query: string;          // 검색어 (필수, 2-100자)
  location?: {            // 검색 중심 위치 (선택)
    lat: number;
    lng: number;
  };
  radius?: number;        // 검색 반경 (선택, 기본 5000m)
}
```

### 12.2 출력 데이터

#### Search Result DTO
```typescript
interface SearchResult {
  places: PlaceItem[];
  totalCount: number;
  hasMore: boolean;
}

interface PlaceItem {
  id: string;                    // 장소 고유 ID
  naverPlaceId: string;          // 네이버 장소 ID
  name: string;                  // 장소명
  address: string;               // 주소
  category: {
    depth1?: string;             // 대분류 (예: 한식)
    depth2?: string;             // 소분류 (예: 소고기 구이)
  };
  location: {
    lat: number;                 // 위도
    lng: number;                 // 경도
  };
  photoUrl?: string;             // 대표 사진 URL
  hasReview: boolean;            // 리뷰 존재 여부
  reviewStats?: {
    count: number;               // 리뷰 개수
    averageRating: number;       // 평균 평점
  };
}
```

---

## 13. Technical Constraints (기술적 제약사항)

### 13.1 API 제약
- **TC-001**: 네이버 Maps API 무료 티어 일일 호출 제한 (10,000건)
- **TC-002**: API 응답 크기는 최대 5MB
- **TC-003**: 검색 결과는 최대 100개까지만 반환

### 13.2 성능 제약
- **TC-004**: 마커는 최대 50개까지만 동시 표시
- **TC-005**: 리스트는 가상 스크롤링 적용 (50개 이상일 때)
- **TC-006**: 이미지는 lazy loading 적용

### 13.3 브라우저 제약
- **TC-007**: Geolocation API 지원 필수
- **TC-008**: ES6+ JavaScript 지원 필수
- **TC-009**: LocalStorage 사용 가능해야 함 (검색 히스토리용)

---

## 14. Assumptions (가정사항)

### 14.1 사용자 환경 가정
- **AS-001**: 사용자는 인터넷 연결이 가능한 환경에 있다
- **AS-002**: 사용자의 브라우저는 JavaScript를 활성화했다
- **AS-003**: 사용자는 위치 권한을 허용했거나 수동으로 위치를 지정할 수 있다

### 14.2 시스템 가정
- **AS-004**: 네이버 Maps API는 99% 이상의 가용성을 보장한다
- **AS-005**: Supabase DB는 정상적으로 작동한다
- **AS-006**: 검색 결과의 장소 정보는 정확하다

### 14.3 데이터 가정
- **AS-007**: 네이버 API가 반환하는 장소 정보는 유효하다
- **AS-008**: 카테고리 정보는 최대 2-depth까지만 제공된다
- **AS-009**: 이미지 URL은 유효한 형식이다

---

## 15. Dependencies (의존성)

### 15.1 외부 의존성
- **DEP-001**: 네이버 지도 JavaScript SDK v3
- **DEP-002**: 네이버 Maps Places API
- **DEP-003**: Supabase JavaScript Client

### 15.2 내부 의존성
- **DEP-004**: 지도 초기화가 완료되어야 함 (UC-001)
- **DEP-005**: API 클라이언트 모듈 (`@/lib/remote/api-client`)
- **DEP-006**: 환경 변수 설정 (`NEXT_PUBLIC_NAVER_MAP_CLIENT_ID`)

---

## 16. Testing Scenarios (테스트 시나리오)

### 16.1 기능 테스트

#### TC-F-001: 정상 검색
- **Given**: 사용자가 메인 페이지에 있음
- **When**: "강남역 한식"을 검색
- **Then**:
  - 검색 결과가 지도에 마커로 표시됨
  - 검색 결과 리스트가 화면에 표시됨
  - 리뷰 유무에 따라 마커 색상이 다름

#### TC-F-002: 검색 결과 없음
- **Given**: 사용자가 검색창에 있음
- **When**: "존재하지않는장소12345"를 검색
- **Then**: "검색 결과가 없습니다" 메시지가 표시됨

#### TC-F-003: 검색어 너무 짧음
- **Given**: 사용자가 검색창에 있음
- **When**: "강"을 입력 (1자)
- **Then**:
  - 검색 버튼이 비활성화됨
  - "최소 2자 이상 입력해주세요" 메시지 표시

#### TC-F-004: 카테고리 미분류
- **Given**: 검색 결과 중 카테고리 정보가 없는 장소가 있음
- **When**: 검색 결과 리스트를 확인
- **Then**: 해당 장소의 카테고리에 "카테고리 미분류" 표시

#### TC-F-005: 이미지 없는 장소
- **Given**: 검색 결과 중 이미지가 없는 장소가 있음
- **When**: 검색 결과 리스트를 확인
- **Then**: 플레이스홀더 이미지가 표시됨

### 16.2 예외 처리 테스트

#### TC-E-001: API 타임아웃
- **Given**: 네이버 API가 응답하지 않음
- **When**: 검색 요청 후 5초 경과
- **Then**:
  - 타임아웃 에러 발생
  - "검색 중 오류가 발생했습니다" 메시지 표시
  - 재시도 옵션 제공

#### TC-E-002: 네트워크 끊김
- **Given**: 네트워크 연결이 끊긴 상태
- **When**: 검색 시도
- **Then**: "인터넷 연결을 확인해주세요" 메시지 표시

#### TC-E-003: DB 조회 실패
- **Given**: Supabase DB 연결 실패
- **When**: 검색 결과를 표시하려 함
- **Then**:
  - 모든 마커가 기본 스타일로 표시됨
  - 검색 결과 리스트는 정상 표시

### 16.3 성능 테스트

#### TC-P-001: 다수 결과 처리
- **Given**: 검색 결과가 100개 이상
- **When**: 검색 수행
- **Then**:
  - 상위 50개만 표시됨
  - 안내 메시지 표시
  - 2초 이내 렌더링 완료

#### TC-P-002: 연속 검색
- **Given**: 사용자가 빠르게 검색어를 변경
- **When**: 1초 이내 3번 검색어 수정
- **Then**:
  - 디바운싱 적용되어 마지막 검색만 실행
  - 불필요한 API 호출 방지

### 16.4 UI/UX 테스트

#### TC-U-001: 반응형 검색창
- **Given**: 모바일 기기 (375px 너비)
- **When**: 검색창 확인
- **Then**:
  - 검색창이 화면 너비의 90%로 표시됨
  - 모든 요소가 정상적으로 배치됨

#### TC-U-002: 키보드 네비게이션
- **Given**: 사용자가 키보드만 사용
- **When**: Tab 키로 검색창 포커스, Enter로 검색
- **Then**: 정상적으로 검색이 실행됨

#### TC-U-003: 스크린 리더
- **Given**: 스크린 리더 사용자
- **When**: 검색 결과 확인
- **Then**: "OO개의 검색 결과가 있습니다" 음성 안내

---

## 17. Open Issues (미해결 이슈)

### 17.1 기술적 이슈
- **ISSUE-001**: 검색 결과 캐싱 전략 결정 필요 (로컬 vs 서버)
- **ISSUE-002**: 검색 히스토리 기능 포함 여부 결정 필요
- **ISSUE-003**: 자동완성 기능 포함 여부 결정 필요

### 17.2 비즈니스 이슈
- **ISSUE-004**: 검색 결과 정렬 기준 추가 필요성 검토 (거리순, 리뷰순)
- **ISSUE-005**: 검색 필터 기능 필요성 검토 (카테고리, 평점)

### 17.3 UX 이슈
- **ISSUE-006**: 모바일 검색 결과 리스트 UI 개선 필요 (스와이프 vs 버튼)
- **ISSUE-007**: 검색 중 지도 인터랙션 제한 여부 결정 필요

---

## 18. Notes (참고사항)

### 18.1 구현 참고사항
- 검색 기능은 `@/features/search` 디렉토리에 구현
- API 클라이언트는 `@/lib/remote/api-client` 사용 필수
- 환경 변수는 `.env.local`에서 관리
- 네이버 Maps SDK는 Script 태그로 로드

### 18.2 관련 문서
- [PRD 문서](/docs/prd.md)
- [User Flow 문서](/docs/userflow.md)
- [Database 스키마](/docs/database.md)
- [네이버 Maps API 문서](https://navermaps.github.io/maps.js.ncp/)

### 18.3 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0 | 2025-10-22 | Senior Developer | 초안 작성 |

---

## 19. Acceptance Criteria (수락 기준)

### 19.1 필수 기준
- [ ] 검색어 2자 이상 입력 시 검색 가능
- [ ] 검색 결과가 지도 마커로 정상 표시
- [ ] 검색 결과가 리스트로 정상 표시
- [ ] 리뷰 유무에 따라 마커 스타일 구분
- [ ] 카테고리 2-depth 형식으로 표시
- [ ] 이미지 없을 시 플레이스홀더 표시
- [ ] API 오류 시 에러 메시지 표시
- [ ] 검색 결과 없을 시 안내 메시지 표시
- [ ] 모바일 반응형 정상 작동
- [ ] 키보드 네비게이션 지원

### 19.2 성능 기준
- [ ] 검색 결과 2초 이내 표시
- [ ] 마커 렌더링 500ms 이내
- [ ] 디바운싱 적용 (300ms)

### 19.3 접근성 기준
- [ ] 스크린 리더 호환
- [ ] 키보드 접근 가능
- [ ] 포커스 인디케이터 명확

---

**문서 승인**
- Product Owner: [ ]
- Engineering Lead: [ ]
- QA Lead: [ ]

---

이 문서는 ConnectMap 프로젝트의 "장소/맛집 검색" 기능에 대한 공식 Usecase Specification입니다.
모든 개발, 테스트, QA 작업은 본 문서를 기준으로 진행됩니다.
